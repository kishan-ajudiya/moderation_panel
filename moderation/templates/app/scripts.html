<script src="/static/moderation/js/jquery-3.4.1.js"></script>
<script src="/static/moderation/js/npm_popper.js@1.16.0_dist_umd_popper.js"></script>
<script src="/static/moderation/js/bootstrap_4.4.1_js_bootstrap.js"></script>
<script src="/static/moderation/js/1.10.20_js_jquery.dataTables.js"></script>
<script src="/static/moderation/js/1.10.20_js_dataTables.bootstrap4.js"></script>
<script src="/static/moderation/js/serializeToJSON.js"></script>
<script src="/static/moderation/js/bootstrap-toggle_2.2.2_js_bootstrap-toggle.js"></script>

<script type="text/javascript">
    $(document).ready(function () {
        $('#data-list-table-pending').DataTable({
                dom: '<"top"f>rt<"bottom"><"clear">',
                ordering: true,
                paging: false,
                info: false
            }
        );
        $('#data-list-table-moderated').DataTable({
                dom: '<"top"f>rt<"bottom"><"clear">',
                ordering: true,
                paging: false,
                info: false
            }
        );
    });

    var csrftoken = jQuery("[name=csrfmiddlewaretoken]").val();

    function csrfSafeMethod(method) {
        // these HTTP methods do not require CSRF protection
        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
    }

    $.ajaxSetup({
        beforeSend: function (xhr, settings) {
            if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                xhr.setRequestHeader("X-CSRFToken", csrftoken);
            }
        }
    });

    function user_assign(obj) {
        var unique_id = $(obj).data("unique_id");
        var user_assigned = 0;
        if ($(obj).prop("checked") === true) {
            user_assigned = 0;
        } else if ($(obj).prop("checked") === false) {
            user_assigned = 1;
        }
        var data = {
            "unique_id": unique_id,
            "user_assignment": user_assigned
        }
        var jsonString = JSON.stringify(data);
        $.ajax({
            url: "/moderation/user-assign/",
            method: 'POST',
            data: jsonString,
            dataType: 'json',
            contentType: 'application/json',
            success: function (data) {
                if (data.message) {
                    alert(data.message);
                }
            },
            error: function (xhr, status, error) {
                var data = xhr.responseJSON;
                if (data.message) {
                    alert(data.message);
                }
            },
        });

    }


    $("#submit-form").click(function () {
        if (document.forms['detail-form'].reportValidity()) {
            var form = $(this).closest("form");
            var obj = $("#detail-form").serializeToJSON({});
            document.forms['detail-form'].reportValidity();
            var jsonString = JSON.stringify(obj);
            $.ajax({
                url: form.attr("action"),
                method: 'POST',
                data: jsonString,
                dataType: 'json',
                contentType: 'application/json',
                success: function (data) {
                    if (data.message) {
                        alert(data.message);
                    }
                    window.location.href = "/moderation/list";
                },
                error: function (xhr, status, error) {
                    var data = xhr.responseJSON;
                    if (data.message) {
                        alert(data.message);
                    }
                }
            });
        } else {
            alert("Please Correct Error Below.");
            document.forms['detail-form'].reportValidity();
        }

    });

</script>